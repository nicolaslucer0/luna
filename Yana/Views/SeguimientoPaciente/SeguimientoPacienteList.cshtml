@{
    ViewData["Title"] = "SeguimientoPacienteList";
    Layout = "~/Views/Shared/_LoggedLayout.cshtml";
}

<script type="text/javascript" language="javascript">

    function Create() {
        window.location.assign("./SeguimientoPacienteManager?idPaciente=" + @ViewBag.IdPaciente + "&idSeguimientoPaciente=0");
    };

    function Edit(id) {
        window.location.assign("./SeguimientoPacienteManager?idPaciente=" + @ViewBag.IdPaciente + "&idSeguimientoPaciente=" + id);
    };

    const splitString = (string) => string && string.length > 20 ? string.substring(0, 20) : string;

    $(document).ready(function () {
            var options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            $.get('@Url.Action("GetSeguimientoPaciente", "SeguimientoPaciente", new { idPaciente = ViewBag.IdPaciente })', function (data) {
                let { seguimientoPaciente } = data;
                
                if (!seguimientoPaciente || seguimientoPaciente.length == 0) {
                    $('#list').append(`
                            <div class="d-flex align-items-center luna-card justify-content-between pl-5 flex-grow"
                                     style="max-width: 100% !important">
                                    <div class="d-flex align-items-center justify-content-center flex-grow-1">
                                        No se han tomado notas.
                                    </div>
                                    <img src="../img/no-notes.jpg" style="width: 20%;"/>
                                </div>`);
                    return;
                }
                

                let headers = `
                    <thead>
                        <tr style="display: none;">
                            <th style="font-family: 'poppinsbold'" scope="col">Fecha creacion</th>
                            <th style="font-family: 'poppinsbold'" scope="col">Nota</th>
                            <th style="font-family: 'poppinsbold'" scope="col">Editar</th>  
                        </tr>
                    </thead>
                `;
                let rows = '<tbody>';
                seguimientoPaciente.forEach(r => {
                    rows += `<tr class="luna-card" style="font-size: 12px">
                            <td>
                                <div style="color: #6385dc; font-family: poppinsbold;">Fecha</div>
                                ${new Date(r.fechaAlta).toLocaleDateString("es-ES", options)}
                            </td>
                            <td class="important-column">
                                <div style="color: #6385dc; font-family: poppinsbold;">Nota</div>
                                ${r.nota}
                            </td>
                            <td>
                                <div style="color: #6385dc; font-family: poppinsbold;">Acción</div>
                                <button data-bs-toggle="tooltip" data-bs-placement="top" title="Notificaciones" class="luna-card--button" onclick="Edit(${r.idSeguimientoPaciente})"><img class="card-icon" src="/img/icon/pencil.png" /></button>
                                
                            </td>
                        </tr>`
                });
                rows += `</tbody>`;
                $('#list').append(headers);
                $('#list').append(rows);
                $('#list').DataTable();
                
        });

    });
</script>

<br />
<div class="container">
    <div id="page-wrapper">
        <div class="row mb50">
            <div class="col-md-12">
                <div class="panel panel-default">
                    
                    <div class="panel-body">
                        
                        <div class="flex-container mb-4">
                            <div class="panel-heading" style="font-size: 25px; margin-bottom: 20px;">
                                <strong style="font-family: 'poppinsbold'">Seguimiento de pacientes</strong>
                            </div>
                            <button class="btn yanaButton" onclick="Create();">Nuevo Seguimiento Paciente</button>
                        </div>
                        <div class="card">
                            <table id="list" class="luna-table dataTable"></table>
                        </div>
                        <div class="row">
                            <div class="col-md-10"></div>
                            <div class="col-md-2">
                                <button onclick="window.location.assign('@Url.Action("PacienteList", "Paciente")'); return false;" class="btn yanaButton"><i class='fa fa-undo fa-lg'></i>Volver</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

