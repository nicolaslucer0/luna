@{
    Layout = "~/Views/Shared/_LoggedLayout.cshtml";
    int idPaciente = ViewBag.IdPaciente;
}

<script type="text/javascript" language="javascript">
    var options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
    function Create() {
        window.location.assign("./NotificacionManager/0?idPaciente=" + @idPaciente);
    };

    function Copy() {
        window.location.assign("./NotificacionCopyList?idPaciente=" + @idPaciente);
    };

    function Standar() {
        window.location.assign("./NotificacionStandarManager?idPaciente=" + @idPaciente);
    };

    function Edit(idNotificacion) {
        window.location.assign("./NotificacionManager?idNotificacion=" + idNotificacion + "&idPaciente=" + @idPaciente);
    };

    const buildCard = (notification) => `
        
            <div class="d-flex align-items-center luna-card flex-column justify-items-center">
                <div class="d-flex justify-content-between card-header">
                    <div class="card-legend">${new Date(notification.fecha).toLocaleDateString("es-ES", options)}</div>
                    <div class="card-status ${notification.estado}">${notification.estado}</div>
                </div>
                <div class="">
                    
                </div>
                <div class="d-flex flex-grow-1 p-3 flex-column text-center align-items-center" style="width: 100%;">
                    <table id="list" class="" cellpadding="0" cellspacing="0">
                                <tbody>
                                    <tr>
                                        <td scope="col" style="font-size: 14px;">${notification.mensaje}</td>
                                    </tr>
                                    ${notification.respuesta ? 
                                        `<tr>
                                            <td scope="col">
                                                <div class="notification-answer">${notification.respuesta}</div>
                                            </td>
                                        </tr>`:  "" 
                                    }
                                    ${notification.descripcion ? `
                                        <tr>
                                            <td scope="col">
                                                <div class="notification-comment">${notification.descripcion}</div>
                                            </td>
                                        </tr>`:  "" 
                                    }
                                </tbody>
                    </table>
                    
                </div>
            </div>

    `;

    $(document).ready(function () {
        

        $.get('@Url.Action("GetNotificaciones", "Notificacion", new { idPaciente = @ViewBag.IdPaciente })', function (data) {
            let registros = data.notificaciones;

            if (registros == null || registros.length == 0) {
                $('#list').append("No hay registros.");
                return;
            }

            let cards = '';
            let notifications = '';
            registros.forEach(p => {
                console.log(p)
                cards += buildCard(p)
            });
            
            $('#list').append(cards);

        });
    });
</script>


<div class="container">
    <div id="page-wrapper">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading" id="panelHead">
                        Notificaciones programadas para: @ViewBag.NombrePaciente
                    </div>
                    <div id="divMessagesP" class="ui-state-highlight ui-corner-all" style="display: none;">
                        <p align="left">
                            <div class="alert alert-danger">
                                <strong>Error!</strong><label id="lblErrorP" style="font-size: 12px; color: firebrick; font-weight: bold; margin-left: 5px;">@TempData["messageERROR"]</label>
                            </div>
                        </p>
                    </div>
                    <div class="panel-body">
                        <p style="color: red; font-weight: 900;">@TempData["messageERROR"]</p>
                        <div>
                            <div class="row">
                                <div class="col-md-6">
                                    <p>
                                        <button class="btn yanaButton" onclick="Create();"><i class="fa fa-plus-square fa-lg"></i>Nueva Notificación</button>
                                    </p>
                                </div>
                            </div>
                            <div>
                                <table id="list" class="d-flex flex-wrap align-items-stretch" cellpadding="0" cellspacing="0" style="margin: 1em 0;">

                                </table>
                                <div id="pager" class="scroll" style="text-align: center;">
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-10"></div>
                            <div class="col-md-2">
                                <button onclick="window.location.assign('@Url.Action("PacienteList", "Paciente")'); return false;" class="btn yanaButton"><i class='fa fa-undo fa-lg'></i>Volver</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

