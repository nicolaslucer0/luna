@using Yana.Helpers
@using Yana.Enums
@using Yana.Models.WrapperEntities
@{
    var menuItems = UserCache.MenuItems;
}

<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>LUNA ~ Si lo sentís, importa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="~/css/font-awesome.min.css">
    <link rel="stylesheet" href="~/css/bootstrap-5.2.1.min.css">
    <link rel="stylesheet" href="~/css/site.css">
    <link rel="stylesheet" href="~/css/siteLoggedLayout.css">
    <link rel="stylesheet" href="~/css/Menu.css" type="text/css" />
    <link rel="stylesheet" href="~/css/Datatables.min.css" type="text/css" />

    <script src='@Url.Content("~/js/jquery-3.6.1.min.js")' type="text/javascript"></script>
    <script src='@Url.Content("~/js/bootstrap.bundle.min.js")' type="text/javascript"></script>
    <script src="~/js/popper.js"></script>

    <script src="~/js/custom.js"></script>
    <script src="~/js/Datatables.min.js"></script>
    <script src="~/js/validators.js"></script>

    <script>
        const RegistroDiario = (id) => window.location.href = "@Url.Action("RegistroDiarioList", "RegistroDiario")" + "?idPaciente=" + id;

        const buildNotifications = (paciente) => `
                     <div class="notification-tile">
                        <div class="notification-icon"><img class="notification-image" src="/img/icon/book.png" /></div>
                        <div class="notification-description" onclick="RegistroDiario(${paciente.idUsuario})">
                            <b>${paciente.nombre} ${paciente.apellido}</b> ha creado ${paciente.notSeenNotifications} <b>${paciente.notSeenNotifications == 1 ? "registro diario" : "registros diarios"}</b>
                        </div>
                    </div>
            `;

        $.get('@Url.Action("GetPacientes", "Paciente")', function (data) {
            let pacientes = data;

            let notifications = '';
            pacientes.filter(p => p.notSeenNotifications > 0).forEach(p => {
                notifications += buildNotifications(p);
            });

            if (notifications) {
            $('#notification-list').append(notifications);
            $('.notification-badge').show();
        }

        else
            $('#notification-list').append("<div class='notification-tile text-center' style='font-size: 11px; justify-content: center;'>No hay nuevas notificaciones</div>");

        });

    </script>
</head>




<body>
    @if (UserCache.IdPerfil != 0)
    {
        <nav class="navbar navbar-expand-lg ">
            <div class="container-fluid">
                <div class="navbar-brand">
                    <a class="navbar-brand" href="#"><img class="sidebar-logo" style="width: 40px; margin-left: 20px;" src="~/img/logo.png" /></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>

                <div class="collapse navbar-collapse justify-content-end" id="navbarTogglerDemo03">
                    <ul id="nav" class="navbar-nav">
                        @if (UserCache.IdPerfil == Convert.ToInt32(EnumPerfilUsuario.Administrador))
                        {
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("Default", "Home")">
                                    <img class="menu-icon" src="~/img/icon/chart.png" />
                                    <div class="hide-mobile" style=" font-size: 15px;">Dashboard</div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("InstitucionList", "Institucion")">
                                    <img class="menu-icon" src="~/img/icon/institution.png" />
                                    <div class="hide-mobile" style=" font-size: 15px;">Instituciones</div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("PsicologoList", "Psicologo")">
                                    <img class="menu-icon" src="~/img/icon/psychologist.png" />
                                    <div class="hide-mobile" style=" font-size: 15px;">Profesionales</div>
                                </a>
                            </li>
                         
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("PacienteList", "Paciente")">
                                    <img class="menu-icon" src="~/img/icon/patient.png" />
                                    <div class="hide-mobile" style=" font-size: 15px;">Pacientes</div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("PatologiaList", "Patologia")">
                                    <img class="menu-icon" src="~/img/icon/brain.png" />
                                    <div class="hide-mobile" style=" font-size: 15px;">Patologias</div>
                                </a>
                            </li>
                        }

                        @if (UserCache.IdPerfil == Convert.ToInt32(EnumPerfilUsuario.Paciente))
                        {
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("Default", "Home")">
                                    <img class="menu-icon" src="~/img/icon/home.png" />
                                    <div class="hide-mobile" style=" font-size: 15px;">Inicio</div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("RegistroDiarioList", "RegistroDiario")">
                                    <img class="menu-icon" src="~/img/icon/book.png" />
                                    <div class="hide-mobile" style=" font-size: 15px;">Registro diario</div>
                                </a>
                            </li>
                        }

                        @if (UserCache.IdPerfil == Convert.ToInt32(EnumPerfilUsuario.Profesional))
                        {
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("Default", "Home")">
                                    <img class="menu-icon" src="~/img/icon/chart.png" />
                                    <div class="hide-mobile" style=" font-size: 15px;">Dashboard</div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="@Url.Action("PacienteList", "Paciente")">
                                    <img class="menu-icon" src="~/img/icon/patient.png" />
                                    <div class="hide-mobile" style=" font-size: 15px;">Pacientes</div>
                                </a>
                            </li>
                            <li class="nav-item notification-container" id="notification-button">
                                <div class="notification-bell">
                                    <img src="~/img/icon/notification.png"
                                 alt="mdo"
                                 width="20"
                                 height="20"
                                 class="rounded-circle" />
                                    <div class="notification-badge"></div>
                                </div>
                                <div class="notification-overlay" id="notification-overlay">
                                    <div class="notification-list" id="notification-list">
                                    </div>
                                    <div class="notification-actions">Ver todas las notificaciones.</div>
                                </div>
                            </li>
                        }

                        @if (UserCache.IdPerfil == Convert.ToInt32(EnumPerfilUsuario.Institucion))
                        {
                            <li>Insti</li>
                        }
                        

                        <li href="#"
                            class="nav-item d-flex align-items-center ml-3"
                            aria-expanded="false">
                            <img src="https://github.com/mdo.png"
                                 alt="mdo"
                                 width="30"
                                 height="30"
                                 class="rounded-circle" />
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="@Url.Action("Logout", "Home")">Salir</a>
                        </li>
                    </ul>
                </div>

            </div>
        </nav>
    }
    <div class="dashboard">
        @RenderBody()
    </div>

</body>


</html>
<script>
    $('#notification-button').click(function () {
        if ($('#notification-overlay').is(":visible"))
            $('#notification-overlay').hide();
        else
            $('#notification-overlay').show();
    });
</script>